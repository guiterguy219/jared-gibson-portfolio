---
import HomeLayout from "@/layouts/HomeLayout.astro";
import { cn } from "@/lib/utils";
import { getCollection } from "astro:content";
import { format } from "date-fns";

const blogPosts = await getCollection("blog").then((posts) =>
  posts
    .filter((post) => ["draft", "published"].includes(post.data.status))
    .sort(
      (a, b) =>
        new Date(b.data.date).getTime() - new Date(a.data.date).getTime()
    )
);
---

<HomeLayout>
  <div class="flex flex-col gap-4">
    {
      blogPosts.map((post) => (
        <a
          href={`/blog/${post.id}`}
          data-disabled={post.data.status === "draft"}
          class={cn("group relative data-[disabled=true]:pointer-events-none")}
        >
          <div class="absolute top-0 left-0 right-0 bottom-2 bg-transparent backdrop-blur-xs -m-1 rounded-md group-data-[disabled=true]:flex hidden items-center justify-center">
            <span class="rounded-full bg-secondary/80 text-secondary-foreground px-4 py-2 backdrop-blur-2xl text-base">
              ðŸš§ Work in Progress ðŸš§
            </span>
          </div>
          <div class="flex flex-col sm:flex-row gap-4 sm:gap-8 pb-4 sm:pb-8">
            <img
              src={post.data.image.sm}
              alt={post.data.title}
              class="w-full sm:max-w-48 h-36 object-cover rounded-md"
            />
            <div class="flex flex-col text-sm sm:text-base">
              <h3 class="text-xl sm:text-2xl font-bold">{post.data.title}</h3>
              <p class="line-clamp-2">{post.data.description}</p>
              <div class="flex-1" />
              <p class="text-sm text-muted-foreground pt-4 sm:pt-8">
                {format(post.data.date, "PP")}
              </p>
            </div>
          </div>
          <hr />
        </a>
      ))
    }
  </div>
</HomeLayout>
